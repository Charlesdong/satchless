{% load i18n %}
{% load prices %}
{% load product_prices %}
{% load products_tags %}
{% load satchless_image %}

    <h2>{% blocktrans with number=order.id %}Order #{{ number }}{% endblocktrans %}</h2>
{% for group in order.groups.all %}
    <table class="order-preview">
        <thead>
            <tr>
                <th>{% trans 'Product' %}</th>
                <th>{% trans 'Unit Price' %}</th>
                <th>{% trans 'Quantity' %}</th>
                <th>{% trans 'Total' %}</th>
            </tr>
        </thead>
        <tfoot>
            {% if group.deliveryvariant.id %}
                {% with group.deliveryvariant.get_subtype_instance as variant %}
                {% if variant.id %}
            <tr>
                <th>
                    {% trans "Delivery" %}<br />
                    <span>{{ variant }}</span>
                </th>
                <td>
                    <span class="fullprice">{{ variant.price|floatformat:2 }}</span>
                    <span class="currency">{{ order.currency }}</span><br />
                </td>
                <td>1</td>
                <td>
                    <span class="fullprice">{{ variant.price|floatformat:2 }}</span>
                    <span class="currency">{{ order.currency }}</span><br />
                </td>
            </tr>
                {% endif %}
                {% endwith %}
            {% endif %}
            <tr>
                <th colspan="3">{% trans 'Total' %}:</th>
                <td>
                    <span class="fullprice">{{ group.total|gross|floatformat:2 }}</span>
                    <span class="currency">{{ order.currency }}</span><br />
                </td>
            </tr>
        </tfoot>
        <tbody>
    {% for item in group.items.all %}
            <tr>
            {% with variant=item.product_variant.get_subtype_instance %}
            {% with product=variant.product %}
            {% with unit_price=item.unit_price item_price=item.price currency=order.currency readonly=1 %}
                <td>
                {% if variant.product.manufacture %}
                    <span class="manufacture">{{ variant.product.manufacture }}</span>
                {% endif %}
                    <a href="{{ variant.product.get_absolute_url }}">{{ variant.product.name }}</a>
                {% with variant|variant_attrs as va %}
                {% if va %}
                    <ul class="variant-attrs">
                {% for attr in va %}
                        <li>{{ attr.name }}: <strong>{{ attr.value }}</strong></li>
                {% endfor %}
                    </ul>
                {% endif %}
                {% endwith %}
                </td>
                <td>
                    <span class="fullprice">{{ unit_price|gross|floatformat:2 }}</span>
                    <span class="currency">{{ currency }}</span>
                </td>
                <td>
                    {{ item.quantity }}
                </td>
                <td>
                    <span class="fullprice">{{ item_price|gross|floatformat:2 }}</span>
                    <span class="currency">{{ currency }}</span>
                </td>
            {% endwith %}
            {% endwith %}
            {% endwith %}
            </tr>
    {% endfor %}
        </tbody>
    </table>
{% endfor %}
